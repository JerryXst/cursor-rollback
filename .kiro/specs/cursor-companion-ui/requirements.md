# 需求文档

## 简介

Cursor伴侣UI功能通过提供全面的对话管理系统来增强现有的cursor-rollback VSCode扩展。该功能将自动跟踪所有Cursor AI对话，在直观的UI界面中显示它们，并在单个消息级别启用精细的回滚功能。用户将能够查看他们的对话历史，管理多个对话线程，并精确地将代码更改和对话上下文回滚到交互历史中的任何特定点。

## 需求

### 需求 1

**用户故事：** 作为使用Cursor的开发者，我希望扩展能够自动跟踪和记录我所有的AI对话，这样我就能拥有完整的交互历史记录而无需手动干预。

#### 验收标准

1. 当新的Cursor AI对话开始时，系统应自动创建带有时间戳和唯一标识符的新对话记录
2. 当用户在Cursor聊天中发送消息时，系统应捕获并存储消息内容、时间戳和相关代码上下文
3. 当Cursor AI回复消息时，系统应捕获并存储AI回复内容、时间戳和所做的任何代码更改
4. 当对话期间进行代码更改时，系统应创建受影响文件及其状态的快照
5. 如果对话跟踪失败，系统应记录错误并继续运行而不中断用户的工作流程

### 需求 2

**用户故事：** 作为开发者，我希望有一个专用的UI面板来查看和管理我所有的Cursor对话，这样我就能轻松浏览我的对话历史。

#### 验收标准

1. 当扩展激活时，系统应提供专用的侧边栏面板用于对话管理
2. 当对话面板打开时，系统应显示按时间顺序排列的所有记录对话列表
3. 当显示对话时，系统应显示每个对话的标题、时间戳、消息数量和状态
4. 当用户点击对话时，系统应展开显示该对话中的单个消息
5. 当显示消息时，系统应显示消息内容、时间戳、发送者（用户/AI）和相关代码更改
6. 如果不存在对话，系统应显示适当的空状态消息

### 需求 3

**用户故事：** 作为开发者，我希望在每个对话消息旁边看到回滚按钮，这样我就能轻松识别回滚点并启动回滚操作。

#### 验收标准

1. 当在对话面板中显示单个消息时，系统应在每个消息旁边显示回滚按钮
2. 当悬停在回滚按钮上时，系统应显示工具提示，指示将回滚什么内容
3. 当点击回滚按钮时，系统应在继续之前提示确认
4. 当确认回滚操作时，系统应暂时禁用回滚按钮以防止重复操作
5. 如果消息没有相关的代码更改，系统应仍然显示回滚按钮，但指示它只会影响对话上下文

### 需求 4

**用户故事：** 作为开发者，我希望能够将代码更改和对话上下文都回滚到特定的消息点，这样我就能返回到开发过程中的任何先前状态。

#### 验收标准

1. 当用户确认回滚操作时，系统应将所有受影响的文件恢复到选定消息点的状态
2. 当执行代码回滚时，系统应在应用更改之前创建当前状态的备份
3. 当执行对话回滚时，系统应将Cursor聊天上下文重置到选定的消息点
4. 当回滚完成时，系统应通知用户成功回滚并显示所做更改的摘要
5. 当回滚失败时，系统应恢复先前状态并向用户通知失败及错误详情
6. 如果多个文件被更改，系统应原子性地回滚所有受影响的文件或完全失败

### 需求 5

**用户故事：** 作为开发者，我希望能够搜索和过滤我的对话历史，这样我就能快速找到特定的对话或主题。

#### 验收标准

1. 当显示对话面板时，系统应在顶部提供搜索输入字段
2. 当用户在搜索字段中输入时，系统应基于消息内容实时过滤对话
3. 当显示搜索结果时，系统应在消息中突出显示匹配的文本
4. 当清除搜索字段时，系统应恢复完整的对话列表
5. 如果没有找到搜索结果，系统应显示适当的"无结果"消息

### 需求 6

**用户故事：** 作为开发者，我希望能够删除或归档旧对话，这样我就能管理我的对话历史并保持界面整洁。

#### 验收标准

1. 当右键点击对话时，系统应显示带有删除和归档选项的上下文菜单
2. 当选择删除时，系统应在永久删除对话之前提示确认
3. 当选择归档时，系统应将对话移动到归档状态并从主列表中隐藏
4. 当查看归档对话时，系统应提供切换显示/隐藏归档项目的功能
5. 如果对话被删除，系统应删除所有相关数据，包括消息历史和代码快照

### 需求 7

**用户故事：** 作为开发者，我希望扩展能够优雅地处理错误，这样我的开发工作流程就不会被扩展故障中断。

#### 验收标准

1. 当任何扩展操作失败时，系统应记录详细的错误信息用于调试
2. 当对话跟踪失败时，系统应继续运行并尝试在下次交互时恢复跟踪
3. 当回滚操作失败时，系统应恢复先前状态并向用户提供清晰的错误消息
4. 当UI渲染失败时，系统应显示后备错误状态并允许用户刷新面板
5. 如果发生关键错误，系统应提供重置扩展状态的方法而不丢失对话数据